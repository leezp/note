## jsonp与jsonp劫持

### 参考资料

[浅谈跨域威胁与安全](https://www.freebuf.com/articles/web/208672.html)

### 什么是跨域

跨域本质就是绕过同源策略的严格限制，安全与实用往往有时候会有一定的矛盾性，开发人员更注重的是功能的开发使用，例如有时候同二级域名下的不同三级域名需要进行一些信息数据传输时，共享一些资源时，同源策略将其限制，但是又要实现该功能，此时就诞生了一些跨越请求的技术。

### 跨域技术

1、跨域请求

2、跨域跳转

### 什么是jsonp

JSONP(JSON with Padding)是JSON的一种“使用模式”，可用于解决主流浏览器的跨域数据访问的问题。利用 ```<script>``` 元素的这个开放策略，网页可以得到从其他来源动态产生的 JSON 资料，而这种使用模式就是所谓的 JSONP。

#### jsonp跨域原理

利用```<script>```标签没有跨域限制的漏洞，网页可以从其他来源域动态获取json数据，jsonp跨域请求一定需要对方的服务器支持才可以。

#### jsonp实现流程

1、服务端必须支持jsonp，且拥有jsonp跨域接口（前提）

2、浏览器客户端声明一个回调函数，其函数名作为参数值，要传递给跨域请求数据的服务器，函数形参为要获取到的返回目标数据

3、创建一个```<script>```标签，把跨域的API数据接口加载到src属性，并且在这个地址向服务器传递该回调函数名

4、服务器会将数据返回到浏览器客户端，此时客户端会调用回调函数，对返回的数据进行处理

#### JSONP跨域安全威胁

1、对于输入的callback函数名过滤不严格，导致输入的数据直接输出到前端造成XSS

2、JSONP劫持漏洞，由于对于来源域没有严格限制，因此来源于不安全的域的请求也会被响应

### 环境

jsonp网页服务器 192.168.255.151:8081  装有dorabox的phpstudy环境

攻击者vps  192.168.0.103

用户访问 网页localhost:8081/jsonp.html 即可 通过存在JSONP劫持漏洞的接口，将用户的该接口对应的信息发送到vps数据库

实际 jsonp后端会验证session,判断是否登陆，返回对应信息

jsonp.html 为jsonp 劫持脚本
